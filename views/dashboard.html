<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Geometrilandia</title>
    <meta name="description" content="Panel principal de Geometrilandia - Selecciona el modo de juego para tu peque√±o explorador">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="dashboard-layout">
        <header class="dashboard-header">
            <div class="container">
                <nav class="dashboard-nav">
                    <div class="dashboard-logo">üè∞ Geometrilandia</div>
                    <div class="dashboard-user">
                        <span id="userName">Cargando...</span>
                        <button id="logoutBtn" class="btn btn-secondary">Cerrar Sesi√≥n</button>
                    </div>
                </nav>
            </div>
        </header>
        
        <main class="dashboard-content">
            <div class="container">
                <div class="dashboard-welcome">
                    <h1>¬°Bienvenido a Geometrilandia! üéâ</h1>
                    <p>Selecciona un modo de juego para comenzar la aventura geom√©trica</p>
                </div>
                
                <div class="game-modes">
                    <div class="game-mode-card" data-mode="libre" role="button" tabindex="0" aria-label="Modo libre de exploraci√≥n">
                        <div class="game-mode-icon">üé®</div>
                        <h2 class="game-mode-title">Modo Libre</h2>
                        <p class="game-mode-description">
                            Explora libremente todas las figuras geom√©tricas. 
                            Perfecto para descubrir y aprender sin presi√≥n.
                        </p>
                        <div class="btn btn-primary btn-large">Comenzar Exploraci√≥n</div>
                    </div>
                    
                    <div class="game-mode-card" data-mode="guiado" role="button" tabindex="0" aria-label="Modo guiado con objetivos">
                        <div class="game-mode-icon">üéØ</div>
                        <h2 class="game-mode-title">Modo Guiado</h2>
                        <p class="game-mode-description">
                            Encuentra figuras espec√≠ficas siguiendo instrucciones. 
                            Ideal para aprendizaje dirigido y pr√°ctica.
                        </p>
                        <div class="btn btn-success btn-large">Iniciar Pr√°ctica</div>
                    </div>
                    
                    <div class="game-mode-card" data-mode="desafio" role="button" tabindex="0" aria-label="Modo desaf√≠o con secuencias">
                        <div class="game-mode-icon">üèÜ</div>
                        <h2 class="game-mode-title">Modo Desaf√≠o</h2>
                        <p class="game-mode-description">
                            Completa secuencias de figuras en orden correcto. 
                            ¬°Pon a prueba la memoria y concentraci√≥n!
                        </p>
                        <div class="btn btn-warning btn-large">Aceptar Desaf√≠o</div>
                    </div>
                </div>
                
                <div class="stats-preview">
                    <div class="game-panel">
                        <h3>üìä Resumen de Progreso</h3>
                        <div class="stats-grid" id="statsGrid">
                            <div class="stat-card">
                                <div class="stat-value" id="totalInteractions">-</div>
                                <div class="stat-label">Interacciones Totales</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="successRate">-</div>
                                <div class="stat-label">Tasa de √âxito</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="favoriteFigure">-</div>
                                <div class="stat-label">Figura Favorita</div>
                            </div>
                        </div>
                        <div class="text-center mt-lg">
                            <button class="btn btn-secondary" onclick="window.location.href='/estadisticas'">
                                Ver Estad√≠sticas Completas
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script src="/js/auth.js"></script>
    <script src="/js/game.js"></script>
    <script>
        // Cargar informaci√≥n del usuario y estad√≠sticas
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Verificar autenticaci√≥n y obtener datos del usuario
                const authResponse = await fetch('/check-auth');
                const authResult = await authResponse.json();
                
                if (authResult.authenticated) {
                    document.getElementById('userName').textContent = authResult.user.nombre;
                } else {
                    window.location.href = '/login';
                    return;
                }
                
                // Cargar estad√≠sticas b√°sicas
                const statsResponse = await fetch('/api/estadisticas');
                const statsResult = await statsResponse.json();
                
                if (statsResult.success) {
                    const stats = statsResult.estadisticas;
                    
                    document.getElementById('totalInteractions').textContent = 
                        stats.resumen.totalInteracciones || 0;
                    
                    document.getElementById('successRate').textContent = 
                        stats.resumen.porcentajeAcierto + '%' || '0%';
                    
                    // Encontrar figura favorita (m√°s interacciones)
                    let figuraFavorita = 'Ninguna';
                    let maxInteracciones = 0;
                    
                    Object.keys(stats.porFigura).forEach(figura => {
                        if (stats.porFigura[figura].interacciones > maxInteracciones) {
                            maxInteracciones = stats.porFigura[figura].interacciones;
                            figuraFavorita = figura;
                        }
                    });
                    
                    document.getElementById('favoriteFigure').textContent = figuraFavorita;
                }
                
            } catch (error) {
                console.error('Error cargando dashboard:', error);
            }
        });
    </script>
</body>
</html>
